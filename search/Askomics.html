<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Count</title>

    <style>
        body {
          background-color: linen;
        }

        h1 {
          color: maroon;
          margin-left: 40px;
        }

        .boxed {
           border: 1px solid green ;
         }
    </style>
</head>
<!--https://cdn.jsdelivr.net/gh/ofilangi/easySparql@develop/ext/es-opt.js-->
<body>
<script>var exports = {"__esModule": true};</script>
<script type="text/javascript" src="../../../discovery/js/target/scala-2.13/discovery-fastopt.js"></script>
<pre id="demo"></pre>

<div id="askomics_code" class="boxed">
    This text is enclosed in a box.
</div>

</body>
<!-- https://dbpedia.org/sparql -->
<!-- http://openstack-192-168-100-31.genouest.org/sparql -->
<!-- https://bbip.askomics.org/virtuoso/sparql -->
<!-- http://endpoint-metabolomics.ara.inrae.fr/metabolights/sparql -->
<script>
      var EasySparqlStatementConfiguration = exports.EasySparqlStatementConfiguration ;
      var EasySparqlEngine = exports.EasySparqlEngine
      var URI = exports.URI

      let config = new EasySparqlStatementConfiguration()

      document.getElementById("askomics_code").appendChild(document.createTextNode("TOTO<br/>"));
      document.getElementById("askomics_code").appendChild(document.createTextNode("TATA<br/>"));
      config.setConfigString(`
          {
          "sources" : [{
          "id"  : "askomics_database",
          "url" : "http://endpoint-metabolomics.ara.inrae.fr/metabolights/sparql",
          "typ" : "tps",
          "method" : "POST",
          "mimetype" : "json"
           }]}
          `)

        async function getEntities() {
            console.log("PRINT ENTITIES")
            let query = new EasySparqlEngine(config);
            let entities =  query
                             .prefix("asko",IRI("http://askomics.org/internal/"))
                             .something("entity")
                                .isA(URI("Class","owl"))
                                .filter.not.contains("http://www.w3.org/2002/07/owl#")
                                .filter.not.isBlank
                             .debug()
                             .sparql_console()
                             .select("entity")
            return entities;
 //            console.log(entities)
/*
             entities.then((res) => {
                  let json = res.json();
                  let v1 = query.variable("entity")
                  console.log(json.results.bindings);
                  let h2 = document.createElement("h2");
                  h2.appendChild(document.createTextNode("Entities"));
                  document.getElementById("demo").appendChild(h2);
                  let listEntities = [];
                  for (let r of json.results.bindings) {
                    document.getElementById("demo").appendChild(document.createTextNode(r[v1].value));
                    listEntities.push(URI(r[v1].value))
                  }
                  return new Promise((resolve, reject) => {
                        console.log('Initial');
                            resolve(listEntities);
                   })
                }).catch( (error) => {
                      console.error(" -- catch exception --")
                      console.error(error)
                })
                */
        }

        getEntities().then( listEntities => {
            console.log("Hello World !!");
            console.log("listEntities:"+JSON.stringify(listEntities));

            for ( entity of listEntities.results.bindings ) {
             console.log("entity:"+JSON.stringify(entity["entity"]));
             let query = new EasySparqlEngine(config);
             let properties = query.something("instance")
                                      .isA(URI(entity["entity"].value))
                                      .isLinkTo(URI"relation")
                                      .sparql_console()

            }

         })
        .catch( (error) => {
          console.error(" -- catch exception --")
          console.error(error)
        } );
    </script>
</html>